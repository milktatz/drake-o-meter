<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Drake-O-Meter</title>

<style>
body {
  margin:0;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto;
  background: linear-gradient(180deg,#002244,#0b1220);
  color:#e5e7eb;
  display:flex;align-items:center;justify-content:center;height:100vh;
}
.container{
  max-width:620px;width:100%;background:#021024;padding:26px;border-radius:18px;
  box-shadow:0 20px 50px rgba(0,0,0,.6);
}
h1{margin-top:0;font-size:2.4rem;color:#c8102e;}
.subtitle{color:#9ca3af;}
.meter{background:#1e293b;height:34px;border-radius:999px;overflow:hidden;margin-bottom:12px;}
.fill{height:100%;width:50%;background:linear-gradient(90deg,#c8102e,#002244);text-align:center;
color:white;font-weight:800;transition:width .4s ease;}
.stats{display:flex;justify-content:space-between;margin-bottom:8px;}
.totalVotes{margin-bottom:16px;font-weight:700;}
button{width:100%;padding:14px;border-radius:14px;border:none;font-size:16px;font-weight:900;cursor:pointer;}
.trust{background:#c8102e;color:white;margin-bottom:12px;}
.distrust{background:#374151;color:white;}
.donate{background:#60a5fa;color:white;margin-top:12px;}
button:disabled{opacity:.4;cursor:not-allowed;}
.footer{margin-top:18px;display:flex;justify-content:space-between;font-size:14px;}
a{color:white;text-decoration:none;font-weight:bold;}
</style>
</head>

<body>
<div class="container">
  <h1>Drake-O-Meter</h1>
  <p class="subtitle">Do you trust Drake May to win the Super Bowl?</p>

  <div class="meter"><div id="fill" class="fill">50%</div></div>

  <div class="stats">
    <div>Trust: <strong id="trustCount">0</strong></div>
    <div>Donâ€™t Trust: <strong id="distrustCount">0</strong></div>
  </div>

  <div class="totalVotes">
    Total Votes: <strong id="totalVotes">0</strong>
  </div>

  <div class="stats">
    <div>Total Site Visits: <strong id="siteVisits">0</strong></div>
  </div>

  <button class="trust" id="trustBtn">Trust Drake May</button>
  <button class="distrust" id="distrustBtn">Donâ€™t Trust Drake May</button>
  <button class="donate" onclick="window.open('https://venmo.com/milktatzz','_blank')">Donate to @milktatzz</button>

  <p id="status"></p>
</div>

<script>
// ðŸ”¹ Pre-configured backend (global votes & site visits)
const API = "https://drakeometer-backend.fly.dev";

const trustEl = document.getElementById("trustCount");
const distrustEl = document.getElementById("distrustCount");
const totalEl = document.getElementById("totalVotes");
const fillEl = document.getElementById("fill");
const visitsEl = document.getElementById("siteVisits");
const statusEl = document.getElementById("status");
const trustBtn = document.getElementById("trustBtn");
const distrustBtn = document.getElementById("distrustBtn");

trustBtn.disabled = true;
distrustBtn.disabled = true;
statusEl.textContent = "Connectingâ€¦";

let userID = localStorage.getItem("drake_user") || crypto.randomUUID();
localStorage.setItem("drake_user", userID);

// Update stats from backend
async function updateStats(){
  const res = await fetch(`${API}/stats`);
  const data = await res.json();
  trustEl.textContent = data.trust;
  distrustEl.textContent = data.distrust;
  totalEl.textContent = data.trust + data.distrust;
  visitsEl.textContent = data.visits;
  const totalVotes = data.trust + data.distrust;
  const pct = totalVotes ? Math.round((data.trust/totalVotes)*100) : 50;
  fillEl.style.width = pct + "%";
  fillEl.textContent = pct + "%";
}

// Vote function
async function vote(type){
  trustBtn.disabled=true;
  distrustBtn.disabled=true;
  statusEl.textContent="Submitting voteâ€¦";

  const res = await fetch(`${API}/vote`,{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body: JSON.stringify({user:userID,type})
  });
  const data = await res.json();
  if(data.success){
    statusEl.textContent="Vote recorded!";
  } else {
    statusEl.textContent=data.message || "Try again later";
  }
  await updateStats();
  setTimeout(()=>{trustBtn.disabled=false; distrustBtn.disabled=false;},3000);
}

trustBtn.onclick=()=>vote("trust");
distrustBtn.onclick=()=>vote("distrust");

updateStats().then(()=>statusEl.textContent="Ready to vote");
</script>
</body>
</html>
