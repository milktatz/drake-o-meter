<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Drake-O-Meter</title>

<style>
body {
  margin:0;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto;
  background: linear-gradient(180deg,#002244,#0b1220);
  color:#e5e7eb;
  display:flex;justify-content:center;align-items:center;
  height:100vh;
}
.container {
  width:100%;
  max-width:600px;
  background:#021024;
  padding:25px;
  border-radius:18px;
  box-shadow:0 20px 50px rgba(0,0,0,0.6);
}
h1 {
  color:#c8102e;
  margin-top:0;
  font-size:2.4rem;
}
.subtitle {
  color:#9ca3af;
  margin-bottom:20px;
}
.meter {
  background:#1e293b;
  border-radius:999px;
  overflow:hidden;
  height:34px;
  margin-bottom:12px;
}
.fill {
  height:100%;
  width:50%;
  background:linear-gradient(90deg,#c8102e,#002244);
  color:white;
  font-weight:800;
  text-align:center;
  line-height:34px;
  transition: width 0.4s ease;
}
.stats, .visits {
  display:flex;
  justify-content:space-between;
  margin-bottom:10px;
}
.totalVotes {
  font-weight:700;
  margin-bottom:15px;
}
button {
  width:100%;
  padding:14px;
  border:none;
  border-radius:14px;
  font-size:16px;
  font-weight:900;
  cursor:pointer;
  margin-bottom:10px;
}
.trust {background:#c8102e;color:white;}
.distrust {background:#374151;color:white;}
.donate {background:#60a5fa;color:white;}
button:disabled {opacity:0.4;cursor:not-allowed;}
.footer {
  margin-top:15px;
  display:flex;
  justify-content:center;
  font-size:14px;
}
a {color:white;text-decoration:none;font-weight:bold;}
#status {margin-top:10px;text-align:center;font-weight:600;}
</style>
</head>
<body>
<div class="container">
  <h1>Drake-O-Meter</h1>
  <p class="subtitle">Do you trust Drake May to win the Super Bowl?</p>

  <div class="meter"><div id="fill" class="fill">50%</div></div>

  <div class="stats">
    <div>Trust: <strong id="trustCount">0</strong></div>
    <div>Don't Trust: <strong id="distrustCount">0</strong></div>
  </div>

  <div class="totalVotes">Total Votes: <strong id="totalVotes">0</strong></div>
  <div class="visits">Total Site Visits: <strong id="siteVisits">0</strong></div>

  <button id="trustBtn" class="trust">Trust Drake May</button>
  <button id="distrustBtn" class="distrust">Don't Trust Drake May</button>
  <button class="donate" onclick="window.open('https://venmo.com/milktatzz','_blank')">Donate to @milktatzz</button>

  <p id="status">Connectingâ€¦</p>
</div>

<script>
// ðŸ”¹ Pre-configured backend API
const API = "https://drakeometer-backend.fly.dev";

const trustEl = document.getElementById("trustCount");
const distrustEl = document.getElementById("distrustCount");
const totalEl = document.getElementById("totalVotes");
const visitsEl = document.getElementById("siteVisits");
const fillEl = document.getElementById("fill");
const statusEl = document.getElementById("status");
const trustBtn = document.getElementById("trustBtn");
const distrustBtn = document.getElementById("distrustBtn");

let userID = localStorage.getItem("drake_user") || crypto.randomUUID();
localStorage.setItem("drake_user", userID);

trustBtn.disabled = false;
distrustBtn.disabled = false;
statusEl.textContent = "Ready to vote";

// Fetch stats
async function updateStats(){
  try {
    const res = await fetch(`${API}/stats`);
    const data = await res.json();
    trustEl.textContent = data.trust;
    distrustEl.textContent = data.distrust;
    totalEl.textContent = data.trust + data.distrust;
    visitsEl.textContent = data.visits;
    const totalVotes = data.trust + data.distrust;
    const pct = totalVotes ? Math.round((data.trust/totalVotes)*100) : 50;
    fillEl.style.width = pct + "%";
    fillEl.textContent = pct + "%";
  } catch(e){
    statusEl.textContent = "Error loading stats";
  }
}

// Voting
async function vote(type){
  trustBtn.disabled=true;
  distrustBtn.disabled=true;
  statusEl.textContent="Submitting voteâ€¦";
  try{
    const res = await fetch(`${API}/vote`,{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body: JSON.stringify({user:userID,type})
    });
    const data = await res.json();
    if(data.success){
      statusEl.textContent="Vote recorded!";
    } else {
      statusEl.textContent=data.message || "Try again in 5 minutes";
    }
    await updateStats();
  } catch(e){
    statusEl.textContent="Error submitting vote";
  } finally {
    setTimeout(()=>{trustBtn.disabled=false; distrustBtn.disabled=false;},3000);
  }
}

trustBtn.onclick = ()=>vote("trust");
distrustBtn.onclick = ()=>vote("distrust");

updateStats();
</script>
</body>
</html>
