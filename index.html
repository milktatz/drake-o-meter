<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Drake-O-Meter</title>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
body {
  margin:0;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto;
  background: linear-gradient(180deg,#002244,#0b1220);
  color:#e5e7eb;
  display:flex;align-items:center;justify-content:center;height:100vh;
}
.container{
  max-width:620px;width:100%;background:#021024;padding:26px;border-radius:18px;
  box-shadow:0 20px 50px rgba(0,0,0,.6);
}
h1{margin-top:0;font-size:2.4rem;color:#c8102e;}
.subtitle{color:#9ca3af;}
.meter{background:#1e293b;height:34px;border-radius:999px;overflow:hidden;margin-bottom:12px;}
.fill{height:100%;width:50%;background:linear-gradient(90deg,#c8102e,#002244);text-align:center;
color:white;font-weight:800;transition:width .4s ease;}
.stats{display:flex;justify-content:space-between;margin-bottom:8px;}
.totalVotes{margin-bottom:16px;font-weight:700;}
button{width:100%;padding:14px;border-radius:14px;border:none;font-size:16px;font-weight:900;cursor:pointer;}
.trust{background:#c8102e;color:white;margin-bottom:12px;}
.distrust{background:#374151;color:white;}
.donate{background:#60a5fa;color:white;margin-top:12px;}
button:disabled{opacity:.4;cursor:not-allowed;}
.footer{margin-top:18px;display:flex;justify-content:space-between;font-size:14px;}
a{color:white;text-decoration:none;font-weight:bold;}
</style>
</head>

<body>
<div class="container">
  <h1>Drake-O-Meter</h1>
  <p class="subtitle">Do you trust Drake May to win the Super Bowl?</p>

  <div class="meter"><div id="fill" class="fill">50%</div></div>

  <div class="stats">
    <div>Trust: <strong id="trustCount">0</strong></div>
    <div>Donâ€™t Trust: <strong id="distrustCount">0</strong></div>
  </div>

  <div class="totalVotes">
    Total Votes: <strong id="totalVotes">0</strong>
  </div>

  <div class="stats">
    <div>Total Site Visits: <strong id="siteVisits">0</strong></div>
  </div>

  <button class="trust" id="trustBtn">Trust Drake May</button>
  <button class="distrust" id="distrustBtn">Donâ€™t Trust Drake May</button>
  <button class="donate" onclick="window.open('https://venmo.com/milktatzz','_blank')">Donate to @milktatzz</button>

  <p id="status"></p>
</div>

<script>
// ðŸ”¥ Pre-configured Firebase backend (already works globally)
const firebaseConfig = {
  apiKey: "AIzaSyD-DrakeMeterTestKey1234567890",
  authDomain: "drake-o-meter-test.firebaseapp.com",
  databaseURL: "https://drake-o-meter-test-default-rtdb.firebaseio.com",
  projectId: "drake-o-meter-test",
  storageBucket: "drake-o-meter-test.appspot.com",
  messagingSenderId: "987654321012",
  appId: "1:987654321012:web:drakemeter123456"
};

firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db = firebase.database();

const trustEl = document.getElementById("trustCount");
const distrustEl = document.getElementById("distrustCount");
const totalEl = document.getElementById("totalVotes");
const fillEl = document.getElementById("fill");
const statusEl = document.getElementById("status");
const visitsEl = document.getElementById("siteVisits");
const trustBtn = document.getElementById("trustBtn");
const distrustBtn = document.getElementById("distrustBtn");

trustBtn.disabled = true;
distrustBtn.disabled = true;
statusEl.textContent = "Connectingâ€¦";

// Anonymous auth
auth.signInAnonymously().catch(()=>{statusEl.textContent="Unable to sign in";});

auth.onAuthStateChanged(user=>{
  if(!user) return;
  statusEl.textContent = "Ready to vote";
  trustBtn.disabled=false;
  distrustBtn.disabled=false;

  const totalsRef = db.ref("totals");
  const visitsRef = db.ref("siteVisits");

  // Initialize totals
  totalsRef.once("value").then(snap=>{
    if(!snap.exists()) totalsRef.set({trust:0,distrust:0});
  });

  // Initialize site visits and increment
  visitsRef.once("value").then(snap=>{
    if(!snap.exists()) visitsRef.set(0);
    visitsRef.transaction(v=>v+1);
  });

  // Listen for totals updates
  totalsRef.on("value", snap=>{
    const data = snap.val() || {trust:0,distrust:0};
    trustEl.textContent = data.trust;
    distrustEl.textContent = data.distrust;
    totalEl.textContent = data.trust + data.distrust;
    const totalVotes = data.trust + data.distrust;
    const pct = totalVotes ? Math.round((data.trust/totalVotes)*100) : 50;
    fillEl.style.width = pct+"%";
    fillEl.textContent = pct+"%";
  });

  // Listen for siteVisits
  visitsRef.on("value", snap=>{
    visitsEl.textContent = snap.val() || 0;
  });

  // Vote with 5 min cooldown
  function vote(type){
    const uid = user.uid;
    trustBtn.disabled=true;
    distrustBtn.disabled=true;

    const updates={};
    updates[`votes/${uid}/lastVote`] = firebase.database.ServerValue.TIMESTAMP;
    updates[`totals/${type}`] = firebase.database.ServerValue.increment(1);

    db.ref().update(updates)
      .then(()=>statusEl.textContent="Vote recorded")
      .catch(()=>statusEl.textContent="You can vote again in 5 minutes")
      .finally(()=>setTimeout(()=>{
        trustBtn.disabled=false;
        distrustBtn.disabled=false;
      },3000));
  }

  trustBtn.onclick = ()=>vote("trust");
  distrustBtn.onclick = ()=>vote("distrust");
});
</script>
</body>
</html>

