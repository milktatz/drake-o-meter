<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Drake-O-Meter</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
body {
  margin: 0;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto;
  background: linear-gradient(180deg, #002244, #0b1220);
  color: #e5e7eb;
  display: flex;
  align-items: center;
  justify-content: center;
  height: 100vh;
}

.container {
  max-width: 620px;
  width: 100%;
  background: #021024;
  padding: 26px;
  border-radius: 18px;
  box-shadow: 0 20px 50px rgba(0,0,0,.6);
}

h1 {
  margin-top: 0;
  font-size: 2.4rem;
  color: #c8102e;
}

.subtitle {
  color: #9ca3af;
}

.meter {
  background: #1e293b;
  height: 34px;
  border-radius: 999px;
  overflow: hidden;
  margin-bottom: 12px;
}

.fill {
  height: 100%;
  width: 50%;
  background: linear-gradient(90deg, #c8102e, #002244);
  text-align: center;
  line-height: 34px;
  color: white;
  font-weight: 800;
  transition: width .4s ease;
}

.stats {
  display: flex;
  justify-content: space-between;
  margin-bottom: 8px;
}

.total {
  margin-bottom: 16px;
  font-weight: 700;
}

button {
  width: 100%;
  padding: 14px;
  border-radius: 14px;
  border: none;
  font-size: 16px;
  font-weight: 900;
  cursor: pointer;
}

.trust {
  background: #c8102e;
  color: white;
  margin-bottom: 12px;
}

.distrust {
  background: #374151;
  color: white;
}

button:disabled {
  opacity: .4;
  cursor: not-allowed;
}

.footer {
  margin-top: 18px;
  display: flex;
  justify-content: space-between;
  font-size: 14px;
}

a {
  color: #60a5fa;
  text-decoration: none;
}
</style>
</head>

<body>
<div class="container">
  <h1>Drake-O-Meter</h1>
  <p class="subtitle">Do you trust Drake May to win the Super Bowl?</p>

  <div class="meter">
    <div id="fill" class="fill">50%</div>
  </div>

  <div class="stats">
    <div>Trust: <strong id="trust">0</strong></div>
    <div>Donâ€™t Trust: <strong id="distrust">0</strong></div>
  </div>

  <div class="total">
    Total Votes: <strong id="total">0</strong>
  </div>

  <button class="trust" id="trustBtn">Trust Drake May</button>
  <button class="distrust" id="distrustBtn">Donâ€™t Trust Drake May</button>

  <p id="status"></p>

  <div class="footer">
    <a href="https://venmo.com/milktatzz" target="_blank">Venmo: @milktatzz</a>
    <span>Secured voting</span>
  </div>
</div>

<script>
<script>
/* ðŸ”¥ YOUR FIREBASE CONFIG (unchanged) ðŸ”¥ */
firebase.initializeApp({
  apiKey: "PASTE_HERE",
  authDomain: "PASTE_HERE",
  databaseURL: "PASTE_HERE",
  projectId: "PASTE_HERE",
  appId: "PASTE_HERE"
});

const auth = firebase.auth();
const db = firebase.database();

const trustEl = document.getElementById("trust");
const distrustEl = document.getElementById("distrust");
const totalEl = document.getElementById("total");
const fill = document.getElementById("fill");
const status = document.getElementById("status");

const trustBtn = document.getElementById("trustBtn");
const distrustBtn = document.getElementById("distrustBtn");

trustBtn.disabled = true;
distrustBtn.disabled = true;
status.textContent = "Connectingâ€¦";

/* âœ… AUTH FIX */
auth.onAuthStateChanged(user => {
  if (!user) return;

  status.textContent = "Ready to vote";
  trustBtn.disabled = false;
  distrustBtn.disabled = false;

  const totalsRef = db.ref("totals");

  /* âœ… Initialize totals if missing */
  totalsRef.once("value").then(snap => {
    if (!snap.exists()) {
      totalsRef.set({ trust: 0, distrust: 0 });
    }
  });

  /* âœ… Live updates */
  totalsRef.on("value", snap => {
    const data = snap.val() || { trust: 0, distrust: 0 };
    const total = data.trust + data.distrust;

    trustEl.textContent = data.trust;
    distrustEl.textContent = data.distrust;
    totalEl.textContent = total;

    const pct = total ? Math.round((data.trust / total) * 100) : 50;
    fill.style.width = pct + "%";
    fill.textContent = pct + "%";
  });

  /* âœ… SAFE VOTE FUNCTION */
  window.vote = function(type) {
    const uid = user.uid;

    trustBtn.disabled = true;
    distrustBtn.disabled = true;

    const updates = {};
    updates[`votes/${uid}/lastVote`] = firebase.database.ServerValue.TIMESTAMP;
    updates[`totals/${type}`] = firebase.database.ServerValue.increment(1);

    db.ref().update(updates)
      .then(() => {
        status.textContent = "Vote recorded";
        setTimeout(() => {
          trustBtn.disabled = false;
          distrustBtn.disabled = false;
        }, 3000);
      })
      .catch(() => {
        status.textContent = "You can vote again in 5 minutes";
        setTimeout(() => {
          trustBtn.disabled = false;
          distrustBtn.disabled = false;
        }, 3000);
      });
  };
});

/* Start anonymous auth */
auth.signInAnonymously();

/* Button hooks */
trustBtn.onclick = () => vote("trust");
distrustBtn.onclick = () => vote("distrust");
</script>
});

function vote(type) {
  const uid = auth.currentUser.uid;
  const updates = {};
  updates[`votes/${uid}/lastVote`] = firebase.database.ServerValue.TIMESTAMP;
  updates[`totals/${type}`] = firebase.database.ServerValue.increment(1);

  db.ref().update(updates)
    .then(() => status.textContent = "Vote recorded")
    .catch(() => status.textContent = "You can vote again in 5 minutes");
}

trustBtn.onclick = () => vote("trust");
distrustBtn.onclick = () => vote("distrust");
</script>
</body>
</html>
